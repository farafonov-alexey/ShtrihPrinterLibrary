[1mdiff --git a/FptrServiceAndroid/build/intermediates/bundles/debug/classes.jar b/FptrServiceAndroid/build/intermediates/bundles/debug/classes.jar[m
[1mindex 92ffee9..a2e7428 100644[m
Binary files a/FptrServiceAndroid/build/intermediates/bundles/debug/classes.jar and b/FptrServiceAndroid/build/intermediates/bundles/debug/classes.jar differ
[1mdiff --git a/FptrServiceAndroid/build/intermediates/bundles/default/classes.jar b/FptrServiceAndroid/build/intermediates/bundles/default/classes.jar[m
[1mindex 7193ac3..3244c5d 100644[m
Binary files a/FptrServiceAndroid/build/intermediates/bundles/default/classes.jar and b/FptrServiceAndroid/build/intermediates/bundles/default/classes.jar differ
[1mdiff --git a/FptrServiceAndroid/build/intermediates/classes/debug/test/librarywrapper/ShtrihPrinterController$1.class b/FptrServiceAndroid/build/intermediates/classes/debug/test/librarywrapper/ShtrihPrinterController$1.class[m
[1mindex 13bce5b..ca8d0fa 100644[m
Binary files a/FptrServiceAndroid/build/intermediates/classes/debug/test/librarywrapper/ShtrihPrinterController$1.class and b/FptrServiceAndroid/build/intermediates/classes/debug/test/librarywrapper/ShtrihPrinterController$1.class differ
[1mdiff --git a/FptrServiceAndroid/build/intermediates/classes/debug/test/librarywrapper/ShtrihPrinterController.class b/FptrServiceAndroid/build/intermediates/classes/debug/test/librarywrapper/ShtrihPrinterController.class[m
[1mindex 2d03e5a..0be78d9 100644[m
Binary files a/FptrServiceAndroid/build/intermediates/classes/debug/test/librarywrapper/ShtrihPrinterController.class and b/FptrServiceAndroid/build/intermediates/classes/debug/test/librarywrapper/ShtrihPrinterController.class differ
[1mdiff --git a/FptrServiceAndroid/build/intermediates/classes/debug/test/librarywrapper/data/GoodsData.class b/FptrServiceAndroid/build/intermediates/classes/debug/test/librarywrapper/data/GoodsData.class[m
[1mindex 17f21c2..f3be290 100644[m
Binary files a/FptrServiceAndroid/build/intermediates/classes/debug/test/librarywrapper/data/GoodsData.class and b/FptrServiceAndroid/build/intermediates/classes/debug/test/librarywrapper/data/GoodsData.class differ
[1mdiff --git a/FptrServiceAndroid/build/intermediates/classes/debug/test/librarywrapper/strategy/TransactionInstruction.class b/FptrServiceAndroid/build/intermediates/classes/debug/test/librarywrapper/strategy/TransactionInstruction.class[m
[1mindex 8be1167..4eff412 100644[m
Binary files a/FptrServiceAndroid/build/intermediates/classes/debug/test/librarywrapper/strategy/TransactionInstruction.class and b/FptrServiceAndroid/build/intermediates/classes/debug/test/librarywrapper/strategy/TransactionInstruction.class differ
[1mdiff --git a/FptrServiceAndroid/build/intermediates/classes/release/test/librarywrapper/ShtrihPrinterController$1.class b/FptrServiceAndroid/build/intermediates/classes/release/test/librarywrapper/ShtrihPrinterController$1.class[m
[1mindex 13bce5b..ca8d0fa 100644[m
Binary files a/FptrServiceAndroid/build/intermediates/classes/release/test/librarywrapper/ShtrihPrinterController$1.class and b/FptrServiceAndroid/build/intermediates/classes/release/test/librarywrapper/ShtrihPrinterController$1.class differ
[1mdiff --git a/FptrServiceAndroid/build/intermediates/classes/release/test/librarywrapper/ShtrihPrinterController.class b/FptrServiceAndroid/build/intermediates/classes/release/test/librarywrapper/ShtrihPrinterController.class[m
[1mindex 2d03e5a..0be78d9 100644[m
Binary files a/FptrServiceAndroid/build/intermediates/classes/release/test/librarywrapper/ShtrihPrinterController.class and b/FptrServiceAndroid/build/intermediates/classes/release/test/librarywrapper/ShtrihPrinterController.class differ
[1mdiff --git a/FptrServiceAndroid/build/intermediates/classes/release/test/librarywrapper/data/GoodsData.class b/FptrServiceAndroid/build/intermediates/classes/release/test/librarywrapper/data/GoodsData.class[m
[1mindex 17f21c2..f3be290 100644[m
Binary files a/FptrServiceAndroid/build/intermediates/classes/release/test/librarywrapper/data/GoodsData.class and b/FptrServiceAndroid/build/intermediates/classes/release/test/librarywrapper/data/GoodsData.class differ
[1mdiff --git a/FptrServiceAndroid/build/intermediates/classes/release/test/librarywrapper/strategy/TransactionInstruction.class b/FptrServiceAndroid/build/intermediates/classes/release/test/librarywrapper/strategy/TransactionInstruction.class[m
[1mindex 8be1167..4eff412 100644[m
Binary files a/FptrServiceAndroid/build/intermediates/classes/release/test/librarywrapper/strategy/TransactionInstruction.class and b/FptrServiceAndroid/build/intermediates/classes/release/test/librarywrapper/strategy/TransactionInstruction.class differ
[1mdiff --git a/FptrServiceAndroid/build/intermediates/incremental/mergeDebugAndroidTestResources/compile-file-map.properties b/FptrServiceAndroid/build/intermediates/incremental/mergeDebugAndroidTestResources/compile-file-map.properties[m
[1mindex d8b2868..11e0ef5 100644[m
[1m--- a/FptrServiceAndroid/build/intermediates/incremental/mergeDebugAndroidTestResources/compile-file-map.properties[m
[1m+++ b/FptrServiceAndroid/build/intermediates/incremental/mergeDebugAndroidTestResources/compile-file-map.properties[m
[36m@@ -1 +1 @@[m
[31m-#Mon Aug 21 09:37:24 MSK 2017[m
[32m+[m[32m#Tue Aug 22 16:09:26 MSK 2017[m
[1mdiff --git a/FptrServiceAndroid/build/intermediates/incremental/packageDebugResources/compile-file-map.properties b/FptrServiceAndroid/build/intermediates/incremental/packageDebugResources/compile-file-map.properties[m
[1mindex 305f0bf..c3650de 100644[m
[1m--- a/FptrServiceAndroid/build/intermediates/incremental/packageDebugResources/compile-file-map.properties[m
[1m+++ b/FptrServiceAndroid/build/intermediates/incremental/packageDebugResources/compile-file-map.properties[m
[36m@@ -1 +1 @@[m
[31m-#Mon Aug 21 09:37:23 MSK 2017[m
[32m+[m[32m#Tue Aug 22 16:09:25 MSK 2017[m
[1mdiff --git a/FptrServiceAndroid/build/intermediates/incremental/packageReleaseResources/compile-file-map.properties b/FptrServiceAndroid/build/intermediates/incremental/packageReleaseResources/compile-file-map.properties[m
[1mindex fd24b47..11e0ef5 100644[m
[1m--- a/FptrServiceAndroid/build/intermediates/incremental/packageReleaseResources/compile-file-map.properties[m
[1m+++ b/FptrServiceAndroid/build/intermediates/incremental/packageReleaseResources/compile-file-map.properties[m
[36m@@ -1 +1 @@[m
[31m-#Fri Aug 18 17:07:58 MSK 2017[m
[32m+[m[32m#Tue Aug 22 16:09:26 MSK 2017[m
[1mdiff --git a/FptrServiceAndroid/build/libs/FptrServiceAndroidVoid.jar b/FptrServiceAndroid/build/libs/FptrServiceAndroid.jar[m
[1msimilarity index 91%[m
[1mrename from FptrServiceAndroid/build/libs/FptrServiceAndroidVoid.jar[m
[1mrename to FptrServiceAndroid/build/libs/FptrServiceAndroid.jar[m
[1mindex ab1261e..827f395 100644[m
Binary files a/FptrServiceAndroid/build/libs/FptrServiceAndroidVoid.jar and b/FptrServiceAndroid/build/libs/FptrServiceAndroid.jar differ
[1mdiff --git a/FptrServiceAndroid/build/outputs/aar/FptrServiceAndroid-debug.aar b/FptrServiceAndroid/build/outputs/aar/FptrServiceAndroid-debug.aar[m
[1mindex af27124..5649404 100644[m
Binary files a/FptrServiceAndroid/build/outputs/aar/FptrServiceAndroid-debug.aar and b/FptrServiceAndroid/build/outputs/aar/FptrServiceAndroid-debug.aar differ
[1mdiff --git a/FptrServiceAndroid/build/outputs/aar/FptrServiceAndroid-release.aar b/FptrServiceAndroid/build/outputs/aar/FptrServiceAndroid-release.aar[m
[1mindex 3a365cb..67d4ab0 100644[m
Binary files a/FptrServiceAndroid/build/outputs/aar/FptrServiceAndroid-release.aar and b/FptrServiceAndroid/build/outputs/aar/FptrServiceAndroid-release.aar differ
[1mdiff --git a/FptrServiceAndroid/build/reports/lint-results.html b/FptrServiceAndroid/build/reports/lint-results.html[m
[1mindex 0e56fd6..ab9d4a2 100644[m
[1m--- a/FptrServiceAndroid/build/reports/lint-results.html[m
[1m+++ b/FptrServiceAndroid/build/reports/lint-results.html[m
[36m@@ -176,7 +176,7 @@[m [mdocument.getElementById(id).style.display = 'none';[m
       <span class="mdl-layout-title">Lint Report: 112 errors and 117 warnings</span>[m
       <div class="mdl-layout-spacer"></div>[m
       <nav class="mdl-navigation mdl-layout--large-screen-only">[m
[31m-Check performed at Fri Aug 18 17:06:16 MSK 2017      </nav>[m
[32m+[m[32mCheck performed at Tue Aug 22 10:01:46 MSK 2017      </nav>[m
     </div>[m
   </header>[m
   <div class="mdl-layout__drawer">[m
[1mdiff --git a/FptrServiceAndroid/src/test/librarywrapper/ShtrihPrinterController.java b/FptrServiceAndroid/src/test/librarywrapper/ShtrihPrinterController.java[m
[1mindex 46af736..83000c0 100644[m
[1m--- a/FptrServiceAndroid/src/test/librarywrapper/ShtrihPrinterController.java[m
[1m+++ b/FptrServiceAndroid/src/test/librarywrapper/ShtrihPrinterController.java[m
[36m@@ -1,8 +1,6 @@[m
 package test.librarywrapper;[m
 [m
 import android.content.Context;[m
[31m-import android.os.Handler;[m
[31m-[m
 import com.shtrih.fiscalprinter.ShtrihFiscalPrinter;[m
 import org.jetbrains.annotations.Nullable;[m
 import java.lang.ref.WeakReference;[m
[36m@@ -76,14 +74,10 @@[m [mpublic class ShtrihPrinterController {[m
             e.printStackTrace();[m
             onDisconnected();[m
             CustomLog.d(LOG_TAG, "onDisconnected();");[m
[31m-//            callbackReceiver.onConnectionError(e.getMessage());[m
[31m-            CustomLog.d(LOG_TAG, "callbackReceiver.onConnectionError(e.getMessage());"+"Thread: "+Thread.currentThread().getName());[m
         } catch (final Exception e) {[m
             e.printStackTrace();[m
             onDisconnected();[m
             CustomLog.d(LOG_TAG, "onDisconnected();");[m
[31m-//            callbackReceiver.onConnectionError(e.getMessage());[m
[31m-            CustomLog.d(LOG_TAG, "callbackReceiver.onConnectionError(e.getMessage());"+"Thread: "+Thread.currentThread().getName());[m
         }[m
     }[m
 [m
[1mdiff --git a/FptrServiceAndroid/src/test/librarywrapper/data/GoodsData.java b/FptrServiceAndroid/src/test/librarywrapper/data/GoodsData.java[m
[1mindex 436b18f..0670ef7 100644[m
[1m--- a/FptrServiceAndroid/src/test/librarywrapper/data/GoodsData.java[m
[1m+++ b/FptrServiceAndroid/src/test/librarywrapper/data/GoodsData.java[m
[36m@@ -12,9 +12,9 @@[m [mpublic class GoodsData {[m
     private final int quantity;[m
 [m
     public GoodsData(double price, String name, int quantity) {[m
[31m-        this.price = (price<=0)||(price>999_999_999)? ReceiptTemplateText.QUANTITY : price;[m
[31m-        this.name = (name == null || name.isEmpty() || (name.length() > 30)) ? ReceiptTemplateText.SERVICE : name;[m
[31m-        this.quantity = (quantity<1)||(price>999_999_999)? ReceiptTemplateText.QUANTITY : quantity;[m
[32m+[m[32m        this.price = price;[m
[32m+[m[32m        this.name = name;[m
[32m+[m[32m        this.quantity = quantity;[m
     }[m
 [m
     public double getPrice() {[m
[1mdiff --git a/FptrServiceAndroid/src/test/librarywrapper/strategy/TransactionInstruction.java b/FptrServiceAndroid/src/test/librarywrapper/strategy/TransactionInstruction.java[m
[1mindex b63557e..fbf4f07 100644[m
[1m--- a/FptrServiceAndroid/src/test/librarywrapper/strategy/TransactionInstruction.java[m
[1m+++ b/FptrServiceAndroid/src/test/librarywrapper/strategy/TransactionInstruction.java[m
[36m@@ -1,6 +1,7 @@[m
 package test.librarywrapper.strategy;[m
 [m
 import com.shtrih.fiscalprinter.ShtrihFiscalPrinter;[m
[32m+[m[32mimport com.shtrih.jpos.fiscalprinter.SmFptrConst;[m
 [m
 import java.util.List;[m
 [m
[36m@@ -32,24 +33,29 @@[m [mpublic class TransactionInstruction extends Instruction {[m
         long payment = 0;[m
         List<GoodsData> goodsDataList = inputData.getGoodsData();[m
         printer.resetPrinter();[m
[31m-        printer.setFiscalReceiptType(FiscalPrinterConst.FPTR_MT_CARD);[m
[31m-        if(inputData.isCash())[m
[31m-            printer.setFiscalReceiptType(FiscalPrinterConst.FPTR_MT_CASH);[m
[31m-        printer.beginFiscalReceipt(false);[m
[32m+[m[32m        if(inputData.getOperationType().equals(PrinterOperationType.REFUND)){[m
[32m+[m[32m            printer.setFiscalReceiptType(SmFptrConst.SMFPTR_RT_RETSALE);[m
[32m+[m[32m        } else{[m
[32m+[m[32m            printer.setFiscalReceiptType(SmFptrConst.SMFPTR_RT_SALE);[m
[32m+[m[32m        }[m
[32m+[m[32m        printer.beginFiscalReceipt(true);[m
         printer.setHeaderLine(1, "", false);[m
         printer.setHeaderLine(2, "", false);[m
         printer.setHeaderLine(3, "", false);[m
[32m+[m[32m        int overallQuantity = 0;[m
         for (GoodsData item: goodsDataList) {[m
             long price = (long) (PRICE_MULTIPLIER*item.getPrice());[m
             int quantity = QUANTITY_MULTIPLIER*item.getQuantity();[m
             payment += price;[m
[32m+[m[32m            overallQuantity +=quantity;[m
             String itemName = item.getName();[m
[31m-            if(inputData.getOperationType().equals(PrinterOperationType.REFUND))[m
[31m-                printer.printRecItemRefund(itemName, 0, quantity, 0, price, "");[m
[31m-            else[m
[31m-                printer.printRecItem(itemName, 0, quantity, 0, price, "");[m
[32m+[m[32m            printer.printRecItem(itemName, 0, quantity, 0, price, "");[m
         }[m
[31m-        printer.printRecTotal(payment, payment, ReceiptTemplateText.RESULT);[m
[32m+[m[32m        printer.printRecSubtotal(0);[m
[32m+[m[32m        if(inputData.isCash())[m
[32m+[m[32m            printer.printRecTotal(0, overallQuantity, "2"); // 2 - Ð½Ð°Ð»[m
[32m+[m[32m        else[m
[32m+[m[32m            printer.printRecTotal(0, overallQuantity, "1"); // 1 - Ð±ÐµÐ·Ð½Ð°Ð»[m
         printer.endFiscalReceipt(false);[m
     }[m
 }[m
